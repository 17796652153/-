<template>
	<view @touchmove.stop.prevent="disabledScroll">
		<swiper 
			:style="'width:' + windowWidth + 'px;height:' + windowHeight + 'px;'"
			:vertical="true" 
			@change="change" 
			:current="current" 
			:indicator-dots="false"
			
		>
			<swiper-item v-for="(list,index) in dataList" :key="index">
				<!-- æ»šåŠ¨è§†é¢‘ -->
				<view class="swiper-item">
					<!--
						1.v-ifï¼šç”¨äºæ§åˆ¶è§†é¢‘åœ¨èŠ‚ç‚¹çš„æ¸²æŸ“æ•°
						2.mutedçš„é»˜è®¤å€¼æ˜¯ falseï¼Œä»£è¡¨é»˜è®¤æ˜¯ç¦éŸ³è§†é¢‘çš„
						3.http-cacheé»˜è®¤å¼€å¯è§†é¢‘ç¼“å­˜
						4.posterï¼ˆå°é¢ï¼ˆæ–¹æ¡ˆä¸€ï¼‰ï¼‰ï¼šè¿™é‡Œçš„å°é¢é»˜è®¤å¤„ç†å­˜å‚¨åœ¨é˜¿é‡Œäº‘çš„è§†é¢‘
						5.page-gestureï¼šåœ¨éå…¨å±æ¨¡å¼ä¸‹ï¼Œæ˜¯å¦å¼€å¯äº®åº¦ä¸éŸ³é‡è°ƒèŠ‚æ‰‹åŠ¿
						6.show-loadingï¼šè¿™é‡Œé»˜è®¤å»æ‰æ’­æ”¾è½¬åœˆçš„æ ‡å¿—
						7.show-fullscreen-btnï¼šæ˜¯å¦æ˜¾ç¤ºå…¨å±æŒ‰é’®
						8.show-center-play-btnï¼šæ˜¯å¦æ˜¾ç¤ºè§†é¢‘ä¸­é—´çš„æ’­æ”¾æŒ‰é’®
						9.enable-progress-gestureï¼šæ˜¯å¦å¼€å¯æ§åˆ¶è¿›åº¦çš„æ‰‹åŠ¿
					 -->
					<video
						v-if="Math.abs(k-index)<=1"
						:id="list._id"
						:loop="true"
						:muted="list.isplay"
						:controls="false"
						:style="'width: '+ windowWidth +'px; height: '+ windowHeight +'px;'"
						:http-cache="true"
						:page-gesture="false"
						:show-fullscreen-btn="false"
						:show-loading="false"
						:show-center-play-btn="false"
						:enable-progress-gesture="false"
						:poster="list.src+'?x-oss-process=video/snapshot,t_100,f_jpg'"
						:src="list.src"
						@ended="ended"
						@click="tapVideoHover(list.state,$event)"
					></video>
				</view>
				
				<!-- æ’­æ”¾çŠ¶æ€ï¼špause çš„æ—¶å€™å°±ä¼šæš‚åœ -->
				<view class="videoHover" @click="tapVideoHover(list.state,$event)" :style="'width: '+ windowWidth +'px; height: '+ windowHeight +'px;'">
					<image v-if="list.state=='pause'" class="playState" src="../../static/player.png" mode=""></image>
				</view>
				
				<!-- é¡¶éƒ¨æœç´¢ -->
				<view class="topSearch">
					<view class="searchContent">
						<image src="../../static/icon_search.png" mode=""></image>
						<input type="text" placeholder-style="color:#fff;" value="" placeholder="è¾“å…¥éœ€è¦æŸ¥è¯¢çš„å†…å®¹" />
					</view>
				</view>
				
				<!-- tabæ  -->
				<view class="topTabs">
					<view class="tabsItem activeItem">å…³æ³¨</view>
					<view class="tabsItem">æ¨è</view>
				</view>
				
				<!-- å³ä¾§ä¿¡æ¯ -->
				<view class="userInfo">
					<!-- å¤´åƒ -->
					<view class="userHead">
						<image class="headPic" src="../../static/user-head.png" mode=""></image>
						<image class="userFollow" src="../../static/icon_add-red.png" mode=""></image>
					</view>
					
					<!-- ç‚¹èµ -->
					<view class="thumbsUp flexColumn">
						<image v-if="true" src="../../static/icon_unFollow-video.png" mode=""></image>
						<image v-if="false" src="../../static/icon_follow-video.png" mode=""></image>
						<text>1.1w</text>
					</view>
					
					<!-- è¯„è®º -->
					<view class="userComment flexColumn" @click="showCommentPopup">
						<image src="../../static/icon_news.png" mode=""></image>
						<text>433</text>
					</view>
					
					<!-- åˆ†äº« -->
					<view class="share flexColumn" @click="shareSharePopup">
						<image src="../../static/icon_share.png" mode=""></image>
						<text>75</text>
					</view>
				</view>
				
				<!-- åº•éƒ¨æ–‡å­— -->
				<view class="content">
					<view class="vedioGoods" @click="showGoodsPopup">
						<image src="../../static/icon_video-cat.png" mode=""></image>
						<text>è´­ç‰© </text>
						<text class="line"></text>
						<text> ä¹±ä¸ƒå…«ç³Ÿ</text>
					</view>
					<view class="myFollow">
						ä½ çš„å…³æ³¨
					</view>
					<view class="userName singleHide">
						ç¾é£Ÿåˆ†äº«å®¶
					</view>
					<view class="words multiHide">
						å››æ–¹é£Ÿäº‹ï¼Œä¸è¿‡ä¸€ç¢—äººé—´çƒŸç«ï¼Œä¸€ä¸ªäººä¹Ÿè¦å¥½å¥½åƒé¥­ã€‚ åŠ æ²¹é™Œç”Ÿäººï¼
					</view>
				</view>
			
				
			
			</swiper-item>
		</swiper>
		
		<!-- åˆ†äº« -->
		<luPopupWrapper ref="luPopupWrapper"
			:type="type"
			:transition="transition"
			:backgroundColor="backgroundColor"
			:active="active"
			:height="height"
			:width="width"
			:popupId="popupId"
			:maskShow="maskShow"
			:maskClick="maskClick"
			:closeCallback="closeCallback"
			>
			<view class="shareBox bottmPopup" :style="isIphoneX ? 'padding-bottom:88rpx;' : 'padding-bottom:20rpx;'">
				<view class="shareList">
					<view class="shareItem" @click="shareFriend">
						<image src="../../static/share-friend.png" mode=""></image>
						<text>å¾®ä¿¡å¥½å‹</text>
						<button open-type="share" class="friend">å¥½å‹</button>
					</view>
					<view class="shareItem" @click="shareMoments">
						<image src="../../static/share-moments.png" mode=""></image>
						<text>æœ‹å‹åœˆ</text>
					</view>
				</view>
				<view class="close" @click="close">
					<image class="pic" src="../../static/icon_clone-yuan.png" mode=""></image>
				</view>
			</view>
		</luPopupWrapper>
	
		<!-- æŸ¥çœ‹å•†å“ -->
		<view class="">
			<view class="mask" v-if="showGoods" @click="hideGoods"></view>
			<view class="vedioGoodsBox bottmPopup" :animation="animationGoods">
				<view class="goodsImg">
					<image class="pic" src="../../static/bg.jpg" mode="aspectFill"></image>
				</view>
				<view class="goodsInfo">
					<view class="goodsName baseflex" @click="jumpGoodsDetail">
						<text class="singleHide">éŸ©å›½ç‰¹è‰²çƒ¤è‚‰è˜¸æ–™è˜¸é…±ï¼ˆåŸå‘³ã€é¦™è¾£ã€ç‰¹è¾£ï¼‰éŸ©å›½ç‰¹è‰²çƒ¤è‚‰è˜¸æ–™è˜¸é…±</text>
						<image src="../../static/icon_arrow-right.png" mode=""></image>
					</view>
					<view class="goodsEnsure">
						<view class="goodsTitle">
							ä¿è¯
						</view>
						<view class="goodsContent singleHide">
							æ­£å“ä¿éšœÂ·7å¤©æ— ç†ç”±é€€è´§
						</view>
					</view>
				</view>
				<view class="goodsOperation" :style="isIphoneX ? 'padding-bottom:88rpx;' : 'padding-bottom:20rpx;'">
					<view class="operationItem" @click="jumpGoodsDetail">
						æŸ¥çœ‹è¯¦æƒ…
					</view>
					<view class="operationItem nowBuy" @click="nowBuyGoods">
						ç«‹å³è´­ä¹°
					</view>
				</view>
				<view class="close" @click="hideGoods">
					<image class="pic" src="../../static/icon_clone-yuan.png" mode=""></image>
				</view>
			</view>
		</view>
	
		<!-- é€‰æ‹©å•†å“è§„æ ¼ -->
		<view class="specs">
			<view class="mask" @click="hideSpec" v-if="showSpecs"></view>
			<scroll-view scroll-y="true" class="specsExplain" :animation="animationSpec">
				<view class="specGoodsInfo">
					<view class="specGoodsImg">
						<image class="pic" src="../../static/bg.jpg" mode="aspectFill"></image>
					</view>
					<view class="specGoodsContent">
						<view class="specGoodsName singleHide">
							éŸ©å›½çƒ¤è‚‰è˜¸æ–™
						</view>
						<view class="specGoodsPrice" v-if="!activeSpec && activeSpec!= 0">
							ï¿¥ <text>9.9</text> èµ·
						</view>
						<view class="specGoodsPrice" v-else>
							ï¿¥ <text>{{goodsSpec[activeSpec].price}}</text>
						</view>
						<view class="specGoodsSpecs multiHide">
							{{activeSpec == 0 || activeSpec ? goodsSpec[activeSpec].specName : 'è¯·é€‰æ‹©å£å‘³'}}
						</view>
					</view>
				</view>
				<view class="goodsSpecAll">
					<view class="specTitle">
						å£å‘³
					</view>
					<view class="selGoodsSpec">
						<view 
							:class="(activeSpec == 0 || activeSpec) && activeSpec === index ? 'goodsSpecItem activeSpecs' : 'goodsSpecItem'" 
							v-for="(item,index) in goodsSpec" 
							:key="index"
							@click="changeSpec(index)"
						>{{item.specName}}</view>
					</view>
				</view>
				<view class="buyGoodsNum baseflex">
					<view class="buyTitle">
						è´­ä¹°æ•°é‡
					</view>
					<view class="changeNum">
						<view class="sub numBtn" @click="sub">-</view>
						<input type="number" v-model="buyNum" @input="verification($event)" @blur="blurInput"/>
						<view class="add numBtn" @click="add">+</view>
					</view>
				</view>
				<view class="buyOperation" @click="buyClick">
					ç«‹å³è´­ä¹°
				</view>
				<view class="close" @click="hideSpec">
					<image class="pic" src="../../static/icon_clone-line.png" mode=""></image>
				</view>
			</scroll-view>
		</view>
	
		<!-- è¯„è®º -->
		<view class="">
			<view class="mask" v-if="showComment" @click="hideComment"></view>
			<scroll-view scroll-y="true" class="comment bottmPopup" :animation="animationComment" :style="isIphoneX ? 'padding-bottom:88rpx;' : 'padding-bottom:20rpx;'">
				<view class="commentTitle" v-if="moreComment">433æ¡è¯„è®º</view>
				<view class="commentTitle" v-else>æ— è¯„è®º</view>
				<view class="commentMain" v-if="moreComment">
					<view class="commentContent">
						<view class="commentUser">
							<view class="commentUserHead">
								<image class="pic" src="../../static/user-head.png" mode=""></image>
							</view>
							<view class="commentUserInfo">
								<view class="commentUserName">
									å°±è¿™æ ·å§
								</view>
								<view class="commentUserContent">
									å…„å¼Ÿä»¬æˆ‘ä»Šå¤©å¤´ä¸Šç—’ç—’çš„å¥½åƒè¦é•¿æ‘„åƒå¤´äº†
								</view>
								<view class="commentTime">
									3å°æ—¶å‰ 
									<text> å›å¤</text>
								</view>
								<view class="commentMore">
									å±•å¼€æ›´å¤š <text></text>
								</view>
							</view>
						</view>
					</view>
					<view class="commentContent">
						<view class="commentUser">
							<view class="commentUserHead">
								<image class="pic" src="../../static/user-head.png" mode=""></image>
							</view>
							<view class="commentUserInfo">
								<view class="commentUserName">
									å°±è¿™æ ·å§
								</view>
								<view class="commentUserContent">
									å…„å¼Ÿä»¬æˆ‘ä»Šå¤©å¤´ä¸Šç—’ç—’çš„å¥½åƒè¦é•¿æ‘„åƒå¤´äº†
								</view>
								<view class="commentTime">
									3å°æ—¶å‰ 
									<text> å›å¤</text>
								</view>
								<view class="reply" id="reply" :animation="animationReply">
									<view class="replyUser">
										<view class="replyUserHead">
											<image class="pic" src="../../static/userHead.png" mode=""></image>
										</view>
										<view class="replyUserInfo">
											<view class="replyUserName">
												é©¬å¤§å“ˆ <text>ä½œè€…</text>
											</view>
											<view class="commentUserContent">
												æ²¡é•¿çš„èµ¶ç´§å»åŒ»é™¢çœ‹çœ‹å§
											</view>
											<view class="commentTime">
												3å°æ—¶å‰ 
												<text> å›å¤</text>
											</view>
										</view>
									</view>
									<view class="replyUser">
										<view class="replyUserHead">
											<image class="pic" src="../../static/userHead.png" mode=""></image>
										</view>
										<view class="replyUserInfo">
											<view class="replyUserName">
												é©¬å°”å’‹å“ˆ <image src="../../static/icon_arrow-rightGray.png" mode=""></image> é©¬å¤§å“ˆ
											</view>
											<view class="commentUserContent">
												æ²¡é•¿çš„èµ¶ç´§å»åŒ»é™¢çœ‹çœ‹å§
											</view>
											<view class="commentTime">
												3å°æ—¶å‰ 
												<text> å›å¤</text>
											</view>
										</view>
									</view>
								</view>
								<view class="commentMore" v-if="showMoreReply" @click="getReply">
									å±•å¼€æ›´å¤š <text></text>
								</view>
							</view>
						</view>
					</view>
					<view class="commentContent" v-for="(item,index) in 5" :key="index">
						<view class="commentUser">
							<view class="commentUserHead">
								<image class="pic" src="../../static/user-head.png" mode=""></image>
							</view>
							<view class="commentUserInfo">
								<view class="commentUserName">
									å°±è¿™æ ·å§
								</view>
								<view class="commentUserContent">
									å…„å¼Ÿä»¬æˆ‘ä»Šå¤©å¤´ä¸Šç—’ç—’çš„å¥½åƒè¦é•¿æ‘„åƒå¤´äº†
								</view>
								<view class="commentTime">
									3å°æ—¶å‰ 
									<text> å›å¤</text>
								</view>
							</view>
						</view>
					</view>
				</view>
				<view class="commentMain nullComment" v-else>
					æš‚æ— è¯„è®ºï¼Œå¿«ç•™ä¸‹çš„æƒ³æ³•å§
				</view>
				<view class="commentInput" :animation="animationInput" :style="isIphoneX ? 'padding-bottom:88rpx;' : 'padding-bottom:20rpx;'">
					<input type="text" value="" placeholder="ç•™ä¸‹ä½ ç²¾å½©çš„è¯„è®ºå§" />
				</view>
				<view class="close" @click="hideComment">
					<image class="pic" src="../../static/icon_clone-line.png" mode=""></image>
				</view>
			</scroll-view>
		</view>
	</view>
</template>

<script>
	let app = getApp();
	import userList from '../../utils/data.js'//è¿™ä¸ªæ˜¯å‡æ•°æ®
	import luPopupWrapper from "../../components/lu-popup-wrapper/lu-popup-wrapper.vue";
	export default {
		components:{
			luPopupWrapper
		},
		data(){
			return {
				isIphoneX: false, // iphoneXæ‰‹æœº
				type:"bottom",// left right top bottom center
				transition:"slider",//none slider fade
				backgroundColor:'#FFF',
				active:false,
				height:"auto",
				width:"100%",
				popupId:1,
				maskShow:true,
				maskClick:true,
				
				// goodsSpec: [], // è§„æ ¼ä¸ºç©º
				goodsSpec: [{
					specName: 'ç‰¹è¾£æ–™8åŒ…',
					price: 9.9
				},{
					specName: 'åº—ä¸»æ¨èï¼ˆåŸå‘³3é¦™è¾£3ç‰¹è¾£2ï¼‰å…±è®¡8åŒ…',
					price: 12.9
				},{
					specName: 'åŸå‘³æ–™8åŒ…',
					price: 9.9
				},{
					specName: 'é¦™è¾£æ–™8åŒ…',
					price: 9.9
				},{
					specName: 'ç‰¹è¾£æ–™1åŒ…',
					price: 1.29
				},{
					specName: 'é¦™è¾£æ–™1åŒ…',
					price: 1.29
				},{
					specName: 'åŸå‘³æ–™1åŒ…',
					price: 1.29
				},], // å•†å“è§„æ ¼
				activeSpec: null, // é€‰ä¸­çš„è§„æ ¼
				
				windowWidth: '', // å±å¹•å®½åº¦
				windowHeight: '', // å±å¹•é«˜åº¦
				
				showShare: false, // æ˜¾ç¤ºåˆ†äº«
				animationShare: {}, // åŠ¨ç”» æ˜¾ç¤ºåˆ†äº«
				
				showGoods: false, // æ˜¾ç¤ºå•†å“
				animationGoods: {}, // åŠ¨ç”» æ˜¾ç¤ºå•†å“
				
				showSpecs: false, // æ˜¾ç¤ºé€‰æ‹©è§„æ ¼
				animationSpec: {}, // åŠ¨ç”» é€‰æ‹©è§„æ ¼
				
				showComment: false, // æ˜¾ç¤ºè¯„è®º
				animationComment: {}, // åŠ¨ç”» è¯„è®º
				animationInput: {}, // åŠ¨ç”» è¯„è®º è¾“å…¥æ¡†
				
				showMoreReply: true, // æ˜¾ç¤ºæ›´å¤šå›å¤
				animationReply: {}, // åŠ¨ç”» æ›´å¤šè¯„è®º
				repalyHeight: 0, // å›å¤çš„è¯„è®ºé«˜åº¦
				
				buyNum: 1, // è´­ä¹°æ•°é‡
				moreComment: true, // æ˜¾ç¤ºè¯„è®ºæ•°
				
				dataList: [], // è§†é¢‘æ•°æ®
				k: 0, // å½“å‰æ’­æ”¾çš„è§†é¢‘
				oldVideo: "",
				voice: "",
				timeout: "",
				current: 0,
				boxStyle:{//è§†é¢‘ï¼Œå›¾ç‰‡å°é¢æ ·å¼ğŸŒŸğŸ’—
					'height': 0,
					'width': 0,
				}
			}
		},
		onLoad() {
			this.isIphoneX = app.globalData.isIphoneX;
			
			this.get(); // åˆšè¿›å…¥é¡µé¢åŠ è½½æ•°æ®
			
			
			// è·å–å±å¹•å®½é«˜
			this.windowWidth = uni.getSystemInfoSync().windowWidth;
			this.windowHeight = uni.getSystemInfoSync().windowHeight;
			
			// æ˜¾ç¤ºåˆ†äº«
			var animateShow = uni.createAnimation({
				duration: 0,
				timingFunction: 'ease',
			})
			this.animateShow = animateShow;
			this.animateShow.bottom(-150).opacity(0).step();
			this.animationShare = this.animateShow.export();
			
			// æ˜¾ç¤ºå•†å“
			var animateGoods = uni.createAnimation({
				duration: 0,
				timingFunction: 'ease',
			})
			this.animateGoods = animateGoods;
			this.animateGoods.bottom(-800).opacity(0).step();
			this.animationGoods = this.animateGoods.export();
			
			// è§„æ ¼é€‰æ‹©
			var animateSpec = uni.createAnimation({
				duration: 0,
				timingFunction: 'ease',
			})
			this.animateSpec = animateSpec;
			this.animateSpec.bottom(-1000).opacity(0).step();
			this.animationSpec = this.animateSpec.export();
			
			// æ˜¾ç¤ºè¯„è®º
			var animateComment = uni.createAnimation({
				duration: 0,
				timingFunction: 'ease',
			})
			this.animateComment = animateComment;
			this.animateComment.bottom(-600).opacity(0).step();
			this.animationComment = this.animateComment.export();
			
			var animateInput = uni.createAnimation({
				duration: 0,
				timingFunction: 'ease',
			})
			this.animateInput = animateInput;
			this.animateInput.bottom(-100).opacity(0).step();
			this.animationInput = this.animateInput.export();
			
			if(!this.moreComment) return
			const query = uni.createSelectorQuery().in(this);
			query.select('#reply').boundingClientRect(data => {
			  // console.log("å¾—åˆ°å¸ƒå±€ä½ç½®ä¿¡æ¯" + JSON.stringify(data));
			  // console.log("èŠ‚ç‚¹ç¦»é¡µé¢é¡¶éƒ¨çš„è·ç¦»ä¸º" + data.top);
			  this.repalyHeight = data.height
			  var animation = uni.createAnimation({
			  	duration: 0,
			  	timingFunction: 'ease',
			  })
			  this.animation = animation
			  this.animation.height(0).step();
			  this.animationReply = this.animation.export();
			}).exec();
		},
		watch:{
			k(k,old_k){
				console.log(k,'watch',old_k);
				this.dataList[old_k].playIng = false; // å¦‚æœè§†é¢‘æš‚åœï¼Œå°±åŠ è½½å°é¢
				this.dataList[old_k].isplay = true;
				this.dataList[old_k].state = 'pause';
				
				uni.createVideoContext(this.dataList[old_k]._id,this).play();
				clearTimeout(this.oldVideo);
				this.oldVideo = setTimeout(() => {
					uni.createVideoContext(this.dataList[old_k]._id,this).seek(0);
					uni.createVideoContext(this.dataList[old_k]._id,this).pause();
					console.log('watchä¸­é¢„ç•™ç¬¬' + (old_k + 1) + 'ä¸ªè§†é¢‘ï¼š' + this.dataList[old_k]._id);
				}, 500)
				
				// 2.0ç‰ˆæœ¬å·²ç»å»æ‰äº†ä¸‹é¢è¿™ä¸€å¥ï¼Œè§†é¢‘ä¸ç”¨æš‚åœï¼Œåªéœ€è¦æŠŠå£°éŸ³ç¦æ­¢å°±è¡Œ
				// uni.createVideoContext(this.dataList[old_k]._id + '' + old_k,this).stop()//å¦‚æœè§†é¢‘æš‚åœï¼Œé‚£ä¹ˆæ—§è§†é¢‘åœæ­¢ï¼Œè¿™é‡Œçš„this.dataList[old_k]._id + '' + old_kï¼Œåé¢åŠ  old_k æ˜¯ä¸ºäº†æ¯ä¸€ä¸ªè§†é¢‘çš„ id å€¼ä¸åŒï¼Œè¿™æ ·å°±å¯ä»¥å¤§ç¨‹åº¦çš„é¿å…ä¸²éŸ³é—®é¢˜
				console.log('å·²ç»æš‚åœ --> ç¬¬' + (old_k + 1) + 'ä¸ªè§†é¢‘ï½')//æç¤º
				this.dataList[k].state = 'play'
				uni.createVideoContext(this.dataList[k]._id,this).play()
				clearTimeout(this.voice)
				this.voice = setTimeout(()=>{
					this.dataList[k].isplay = false
				},300)
				setTimeout(()=>{
					this.dataList[k].playIng = true
				},850)
				//ã€2.0ç‰ˆæœ¬æ›´æ–°å†…å®¹ã€‘- start
				var p = k
				++p
				setTimeout(()=>{
					uni.createVideoContext(this.dataList[p]._id,this).play()
				},20)
				clearTimeout(this.timeout)
				this.timeout = setTimeout(()=>{
					uni.createVideoContext(this.dataList[p]._id,this).seek(0)
					uni.createVideoContext(this.dataList[p]._id,this).pause()
					console.log('watchä¸­é¢„åŠ è½½ç¬¬' + (p + 1) + 'ä¸ªè§†é¢‘ 2 å·ï¼š' + this.dataList[p]._id)
				},1800)
			}
		},
		methods:{
			
			// ç‚¹å‡»è§†é¢‘æ’­æ”¾ä¸æš‚åœ
			tapVideoHover(state,event){
				if(state == 'play' || state == 'continue'){ // åˆæ¬¡ç‚¹å‡»æ—¶è§†é¢‘é»˜è®¤æ’­æ”¾
					this.dataList[this.k].state = 'pause'
				}else{
					this.dataList[this.k].state = 'continue'
				}
				if(this.dataList[this.k].state == 'pause'){
					uni.createVideoContext(this.dataList[this.k]._id,this).pause(); // æ’­æ”¾æ—¶ç‚¹å‡»æš‚åœ
				}
				
				if(this.dataList[this.k].state == 'continue'){
					uni.createVideoContext(this.dataList[this.k]._id,this).play(); // æš‚åœæ˜¯ç‚¹å‡»æ’­æ”¾
				}
			},
			
			// è§†é¢‘æ’­æ”¾ç»“æŸ
			ended(){
				// 1.æ’­æ”¾å½“å‰è§†é¢‘ç»“æŸæ—¶è§¦å‘ï¼Œè‡ªåŠ¨åˆ‡æ¢ä¸‹ä¸€ä¸ªè§†é¢‘
				this.current = this.k + 1;
			},
			
			// æ»‘åŠ¨åˆ‡æ¢ä¸‹ä¸€ä¸ªè§†é¢‘
			change(event){
				this.current = event.detail.current;
				this.k = event.detail.current;
				// 1.è¿™é‡Œè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæ˜¯æœ€åä¸€ä¸ªè§†é¢‘å°±è¿›å…¥ get() æ–¹æ³•åŠ è½½è§†é¢‘è¿›å…¥åˆ—è¡¨
				if(this.k == this.dataList.length - 1){
					this.get()
				}
			},
			
			// è·å–è§†é¢‘æ•°æ®
			get(){
				// 1. ä»æ¥å£è°ƒç”¨æ•°æ®è·å–è§†é¢‘
				let msg = userList;
				// 2. å°†è§†é¢‘æ·»åŠ è¿›è§†é¢‘åˆ—è¡¨
				for(let i = 0; i < msg.length; i++){
					this.dataList.push(msg[i])
				}
				// 3. æ’­æ”¾è§†é¢‘
				setTimeout(() => {
					this.dataList[this.k].playIng = true;
					this.dataList[this.k].state = 'play';
					uni.createVideoContext(this.dataList[this.k]._id,this).play()
				}, 200)
				
				// start -- é¢„åŠ è½½
				var p = this.k;
				++p;
				setTimeout(() => {
					uni.createVideoContext(this.dataList[p]._id,this).play()
				},20)
				clearTimeout(this.timeout)
				this.timeout = setTimeout(() => {
					uni.createVideoContext(this.dataList[p]._id,this).seek(0);
					uni.createVideoContext(this.dataList[p]._id,this).pause();
					console.log('getä¸­é¢„åŠ è½½ç¬¬' + (p + 1) + 'ä¸ªè§†é¢‘ï¼š' + this.dataList[p]._id);
				},1500)
			},
			
			show: function() {
				uni.hideTabBar({
					animation:false
				})
			    this.$refs.luPopupWrapper.show();
			},
			close: function() {
				setTimeout(function(){
					uni.showTabBar({
						animation: false
					})
				},200)
			    this.$refs.luPopupWrapper.close();
			},
			closeCallback:function() {
			    console.log("å…³é—­åå›è°ƒ");
				uni.showTabBar({
					animation: false
				})
			},
			
			disabledScroll(){
			    return
			},
			
			// å¼¹å‡ºåˆ†äº«å¼¹çª—
			shareSharePopup(){
				this.show()
			},
			
			// éšè—åˆ†äº«å¼¹çª—
			hideShare(){
				this.close()
			},
			
			// åˆ†äº«æœ‹å‹åœˆ
			shareMoments(){
				uni.showToast({
					title: "ç‚¹å‡»å³ä¸Šè§’åˆ†äº«åˆ°æœ‹å‹åœˆ",
					icon: 'none',
					duration: 3000
				})
				
				setTimeout(function(){
					uni.hideToast()
				},3000)
			},
		
			// å¼¹å‡ºå•†å“ä¿¡æ¯
			showGoodsPopup(){
				this.showGoods = true;
				uni.hideTabBar({
					animation:false
				})
				// æ˜¾ç¤ºå•†å“
				var animateGoods = uni.createAnimation({
					duration: 600,
					timingFunction: 'ease',
				})
				this.animateGoods = animateGoods;
				this.animateGoods.bottom(0).opacity(1).step();
				this.animationGoods = this.animateGoods.export();
			},
		
			// éšè—å•†å“
			hideGoods(){
				this.showGoods = false
				// æ˜¾ç¤ºå•†å“
				var animateGoods = uni.createAnimation({
					duration: 500,
					timingFunction: 'ease',
				})
				this.animateGoods = animateGoods;
				this.animateGoods.bottom(-800).opacity(0).step();
				this.animationGoods = this.animateGoods.export();
				setTimeout(function(){
					uni.showTabBar({
						animation: false
					})
				},280)
			},
		
			// è·³è½¬å•†å“è¯¦æƒ…
			jumpGoodsDetail(){
				this.hideGoods()
				setTimeout(() => {
					uni.navigateTo({
						url: "../goods/details"
					})
				},300)
			},
		
			// ç«‹å³è´­ä¹°
			nowBuyGoods(){
				this.showGoods = false
				// æ˜¾ç¤ºå•†å“
				var animateGoods = uni.createAnimation({
					duration: 500,
					timingFunction: 'ease',
				})
				this.animateGoods = animateGoods;
				this.animateGoods.bottom(-800).opacity(0).step();
				this.animationGoods = this.animateGoods.export();
				
				if(this.goodsSpec.length > 0){
					this.showSpec()
				}else{
					setTimeout(function(){
						uni.showTabBar({
							animation: false
						})
						uni.navigateTo({
							url: "../confirmOrder/confirmOrder"
						})
					},200)
				}
			},
		
			// åˆ‡æ¢é€‰ä¸­çš„è§„æ ¼
			changeSpec(idx){
				this.activeSpec = idx;
			},
			
			// è´­ä¹°å•†å“ or æ·»åŠ è´­ç‰©è½¦
			showSpec(){
				uni.hideTabBar({
					animation:false
				})
				
				this.showSpecs = true;
				this.buyNum = 1
				var animateSpec = uni.createAnimation({
					duration: 600,
					timingFunction: 'ease',
				})
				this.animateSpec = animateSpec;
				this.animateSpec.bottom(0).opacity(1).step();
				this.animationSpec = this.animateSpec.export();
			},
			
			// éšè—è§„æ ¼
			hideSpec(){
				this.showSpecs = false;
				var animateSpec = uni.createAnimation({
					duration: 500,
					timingFunction: 'ease',
				})
				this.animateSpec = animateSpec;
				this.animateSpec.bottom(-1000).opacity(0).step();
				this.animationSpec = this.animateSpec.export();
				
				setTimeout(function(){
					uni.showTabBar({
						animation: false
					})
				},280)
			},
			
			// å‡å°‘æ•°é‡
			sub(){
				let buyNum = parseInt(this.buyNum)
				if(buyNum <= 1){
					console.log('ä¸èƒ½å†å°‘äº†');
					return
				}
				buyNum -= 1
				this.buyNum = buyNum
			},
			
			// å¢åŠ æ•°é‡
			add(){
				let buyNum = parseInt(this.buyNum)
				buyNum += 1
				this.buyNum = buyNum;
			},
					
			// æ•°å­—æ ¡éªŒ
			verification(e){
				console.log(e.detail.value);
				this.buyNum = e.detail.value.replace(/[^\d]/g,'')
			},
			blurInput(){
				let buyNum = this.buyNum
				buyNum = buyNum.replace(/[^\d]/g,'');
				
				parseInt(buyNum);
				console.log(buyNum);
				if(buyNum <= 1){
					this.buyNum = 1;
					return
				}
				this.buyNum = buyNum
			},
			
			// åŠ å…¥è´­ç‰©è½¦ or ç«‹å³è´­ä¹°
			buyClick(){
				let lgn = this.goodsSpec.length;
				if(lgn > 0){
					console.log(this.activeSpec);
					if(!this.activeSpec){
						if(this.activeSpec != 0){
							uni.showToast({
							title: 'è¯·é€‰æ‹©è§„æ ¼',
							icon: 'none'
						})
						return
						}
						
					}
				}
				
				this.hideSpec()
				setTimeout(function(){
					uni.showTabBar({
						animation: false
					})
					uni.navigateTo({
						url: "../confirmOrder/confirmOrder"
					})
				},200)
			},
		
			// æ˜¾ç¤ºè¯„è®º
			showCommentPopup(){
				this.showComment = true;
				uni.hideTabBar({
					animation:false
				})
				
				var animateComment = uni.createAnimation({
					duration: 600,
					timingFunction: 'ease',
				})
				this.animateComment = animateComment;
				this.animateComment.bottom(0).opacity(1).step();
				this.animationComment = this.animateComment.export();
				
				var animateInput = uni.createAnimation({
					duration: 300,
					timingFunction: 'ease',
				})
				this.animateInput = animateInput;
				this.animateInput.bottom(0).opacity(1).step();
				this.animationInput = this.animateInput.export();
			},
			
			// éšè—è¯„è®º
			hideComment(){
				this.showComment = false;
				
				var animateComment = uni.createAnimation({
					duration: 500,
					timingFunction: 'ease',
				})
				this.animateComment = animateComment;
				this.animateComment.bottom(-600).opacity(0).step();
				this.animationComment = this.animateComment.export();
				
				var animateInput = uni.createAnimation({
					duration: 300,
					timingFunction: 'ease',
				})
				this.animateInput = animateInput;
				this.animateInput.bottom(-100).opacity(0).step();
				this.animationInput = this.animateInput.export();
				setTimeout(function(){
					uni.showTabBar({
						animation: false
					})
				},280)
			},
		
			// è·å–å›å¤é«˜åº¦
			getReply(){
				// è°ƒæ•´å•†å“è¯¦æƒ…é«˜åº¦
				const query = uni.createSelectorQuery().in(this);
				query.select('#reply').boundingClientRect(data => {
				  console.log("å¾—åˆ°å¸ƒå±€ä½ç½®ä¿¡æ¯" + JSON.stringify(data));
				  console.log("èŠ‚ç‚¹ç¦»é¡µé¢é¡¶éƒ¨çš„è·ç¦»ä¸º" + data.top);
				  var animation = uni.createAnimation({
				  	duration: 300,
				  	timingFunction: 'ease',
				  })
				  this.animation = animation
				  this.animation.height(this.repalyHeight).step();
				  this.animationReply = this.animation.export();
				}).exec();	
				
				this.showMoreReply = false
			},
		},
		onShareAppMessage() {
		    // const promise = new Promise(resolve => {
		    //   setTimeout(() => {
		    //     resolve({
		    //       title: 'è½¬å‘å¥½å‹è¿™ä¸ªè§†é¢‘'
		    //     })
		    //   }, 2000)
		    // })
			this.close()
		    return {
		      title: 'è½¬å‘å¥½å‹è¿™ä¸ªè§†é¢‘',
		      // promise 
		    }
			
			
		},
		onShareTimeline(){},
	}
</script>

<style lang="less">
	.videoHover{
		position: absolute;
		left: 0;
		top: 0;
		width: 100%;
		height: 100%;
		.playState{
			position: absolute;
			left: 50%;
			top: 50%;
			width: 100rpx;
			height: 100rpx;
			opacity: 0.85;
			transform: translateX(-50%) translateY(-50%);
		}
	}
	
	.topSearch{
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		padding: 20rpx 30rpx;
		.searchContent{
			width: 690rpx;
			height: 64rpx;
			border: 2rpx solid #ffffff;
			border-radius: 34rpx;
			display: flex;
			align-items: center;
			overflow: hidden;
			image{
				width: 40rpx;
				height: 40rpx;
				margin-left: 20rpx;
				vertical-align: middle;
			}
			input{
				height: 100%;
				font-size: 28rpx;
				color: #fff;
				width: 576rpx;
				padding-left: 20rpx;
			}
		}
	}
	
	.topTabs{
		position: absolute;
		top: 104rpx;
		left: 0;
		width: 100%;
		display: flex;
		align-items: center;
		justify-content: space-around;
		padding: 20rpx 30rpx;
		.tabsItem{
			color: #fff;
			font-size: 36rpx;
			width: 50%;
			height: 66rpx;
			text-align: center;
		}
		.activeItem{
			position: relative;
			&::after{
				content: "";
				position: absolute;
				bottom: 0;
				left: 50%;
				transform: translateX(-50%);
				width: 48rpx;
				height: 4rpx;
				background: #ffffff;
				border-radius: 2rpx;
			}
		}
	}
	
	.userInfo{
		position: absolute;
		right: 10rpx;
		bottom: 120rpx;
		display: flex;
		flex-direction: column;
		z-index: 9;
		.userHead{
			position: relative;
			margin-bottom: 50rpx;
			border-radius: 50%;
			.headPic{
				width: 80rpx;
				height: 80rpx;
				border: 2rpx solid #fff;
				border-radius: 50%;
				overflow: hidden;
			}
			.userFollow{
				position: absolute;
				left: 50%;
				bottom: -14rpx;
				transform: translateX(-50%);
				width: 28rpx;
				height: 28rpx;
			}
		}
	}
	
	.flexColumn{
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		margin-bottom: 30rpx;
		image{
			width: 52rpx;
			height: 52rpx;
			margin-bottom: 10rpx;
		}
		text{
			color: #fff;
			font-size: 20rpx;
		}
	}
	
	.content{
		position: absolute;
		left: 0;
		bottom: 0;
		width: 100%;
		color: #fff;
		padding: 40rpx 30rpx;
		.vedioGoods{
			position: relative;
			height: 36rpx;
			display: inline-block;
			padding-right: 10rpx;
			line-height: 36rpx;
			background: rgba(255,255,255,0.10);
			border-radius: 10rpx;
			margin-bottom: 20rpx;
			image{
				width: 36rpx;
				height: 36rpx;
				margin-right: 8rpx;
				// vertical-align: middle;
			}
			text{
				font-size: 20rpx;
				color: #fff;
				vertical-align: super;
			}
			.line{
				display: inline-block;
				width: 2rpx;
				height: 12rpx;
				background: #e5e5e5;
				margin: 0 8rpx;
			}
		}
		.myFollow{
			width: 124rpx;
			height: 36rpx;
			line-height: 36rpx;
			text-align: center;
			background: #ffffff;
			border-radius: 10rpx;
			color: #333;
			font-size: 24rpx;
			margin-bottom: 20rpx;
		}
		.userName{
			font-size: 28rpx;
			max-width: 300rpx;
			margin-bottom: 20rpx;
		}
		.words{
			font-size: 24rpx;
			max-width: 580rpx;
			max-height: 130rpx;
			-webkit-line-clamp: 4;
		}
	}

	.mask{
		position: fixed;
		left: 0;
		top: 0;
		z-index: 999;
		width: 100%;
		height: 100%;
	}
	
	.bottmPopup{
		background: #ffffff;
		border-radius: 20rpx 20rpx 0rpx 0rpx;
		overflow: hidden;
		position: absolute;
		left: 0;
		bottom: 0;
		z-index: 9999;
		box-sizing: initial;
	}
	
	.shareBox{
		width: calc(100% - 60rpx);
		padding: 50rpx 30rpx 20rpx;
		position: relative;
		.close{
			position: absolute;
			right: 20rpx;
			top: 20rpx;
			width: 28rpx;
			height: 28rpx;
		}
	}
	
	.shareList{
		display: flex;
		align-items: center;
		width: 100%;
		.shareItem{
			display: flex;
			flex-direction: column;
			align-items: center;
			margin-right: 60rpx;
			position: relative;
			image{
				width: 80rpx;
				height: 80rpx;
				margin-bottom: 12rpx;
			}
			text{
				color: #333;
				font-size: 32rpx;
			}
			button{
				position: absolute;
				left: 0;
				top: 0;
				height: 134rpx;
				opacity: 0;
			}
		}
	}
	
	.vedioGoodsBox{
		width: 100%;
		.goodsImg{
			height: 748rpx;
			width: 100%;
		}
		.goodsInfo{
			padding: 20rpx 30rpx 38rpx;
			.goodsName{
				color: #333;
				font-size: 28rpx;
				margin-bottom: 20rpx;
				text{
					display: inline-block;
					max-width: 584rpx;
				}
				image{
					width: 24rpx;
					height: 24rpx;
				}
			}
			.goodsEnsure{
				font-size: 28rpx;
				display: flex;
				align-items: center;
				.goodsTitle{
					color: #333;
					margin-right: 20rpx;
				}
				.goodsContent{
					color: #999;
					max-width: 500rpx;
				}
			}
		}
		.goodsOperation{
			padding: 20rpx 30rpx;
			border-top: 2rpx solid #E5E5E5;
			display: flex;
			align-items: center;
			justify-content: space-between;
			.operationItem{
				width: 330rpx;
				height: 68rpx;
				background: #ffc7c7;
				border-radius: 10rpx;
				color: #FF2D2D;
				font-size: 28rpx;
				text-align: center;
				line-height: 68rpx;
			}
			.nowBuy{
				color: #fff;
				background-color: #FF2D2D;
			}
		}
		.close{
			position: absolute;
			left: 30rpx;
			top: 28rpx;
			width: 28rpx;
			height: 28rpx;
		}
	}
	
	.specsExplain{
		position: fixed;
		left: 0;
		bottom: 0;
		width: 100%;
		max-height: calc(100% - 100rpx);
		background: #ffffff;
		border-radius: 20rpx 20rpx 0rpx 0rpx;
		z-index: 9999;
		padding: 40rpx 30rpx 20rpx;
		box-sizing: border-box;
		.specGoodsInfo{
			display: flex;
			align-items: center;
			.specGoodsImg{
				width: 200rpx;
				height: 200rpx;
				border-radius: 8rpx;
				overflow: hidden;
				margin-right: 20rpx;
				flex-shrink: 0;
			}
			.specGoodsContent{
				flex-shrink: 0;
				max-width: 400rpx;
			}
			.specGoodsName{
				color: #333;
				font-size: 32rpx;
			}
			.specGoodsPrice{
				color: #FF2D2D;
				font-size: 28rpx;
				margin: 14rpx 0;
				text{
					font-size: 42rpx;
					margin: 0 4rpx;
				}
			}
			.specGoodsSpecs{
				color: #999;
				font-size: 28rpx;
				height: 76rpx;
			}
		}
		.goodsSpecAll{
			margin-top: 40rpx;
			.specTitle{
				font-size: 28rpx;
				color: #333;
				margin-bottom: 20rpx;
			}
			.selGoodsSpec{
				width: 100%;
				height: auto;
				display: flex;
				align-items: center;
				flex-wrap: wrap;
				.goodsSpecItem{
					background: #e5e5e5;
					border-radius: 6rpx;
					padding: 12rpx;
					font-size: 28rpx;
					color: #666;
					margin-right: 20rpx;
					margin-bottom: 20rpx;
				}
				.activeSpecs{
					color: #fff;
					background-color: #FF2D2D;
				}
			}
		}
		.buyGoodsNum{
			margin: 50rpx 0 40rpx;
			.changeNum{
				display: flex;
				align-items: center;
			}
			.numBtn{
				width: 40rpx;
				height: 40rpx;
				background: #f2f2f2;
				border-radius: 4rpx;
				font-size: 32rpx;
				font-weight: 600;
				line-height: 40rpx;
				text-align: center;
			}
			input{
				height: 40rpx;
				max-width: 84rpx;
				text-align: center;
				font-size: 28rpx;
				color: #333;
			}
		}
		.buyOperation{
			width: 690rpx;
			height: 72rpx;
			background: #ff2d2d;
			border-radius: 10rpx;
			line-height: 72rpx;
			text-align: center;
			font-size: 28rpx;
			color: #fff;
		}
		.close{
			position: absolute;
			right: 30rpx;
			top: 20rpx;
			width: 40rpx;
			height: 40rpx;
		}
	}

	.comment{
		width: 100%;
		max-height: 900rpx;
		padding-top: 20rpx;
		.commentTitle{
			color: #333333;
			font-size: 24rpx;
			text-align: center;
		}
		.commentMain{
			padding: 20rpx 30rpx;
			width: calc(100% - 60rpx);
			margin: 40rpx auto;
			.commentContent{
				margin-bottom: 40rpx;
			}
			.commentUser{
				display: flex;
				.commentUserHead{
					width: 60rpx;
					height: 60rpx;
					margin-right: 20rpx;
					border-radius: 50%;
					overflow: hidden;
				}
				.commentUserInfo{
					max-width: 480rpx;
					font-size: 24rpx;
					color: #333;
					.commentUserName{
						color: #666;
					}
					.commentUserContent{
						max-width: 480rpx;
						margin: 16rpx 0;
					}
					.commentTime{
						color: #999;
						margin-bottom: 16rpx;
						text{
							color: #666;
							margin-left: 20rpx;
						}
					}
					.commentMore{
						color: #666;
						text{
							display: inline-block;
							width: 0;
							height: 0;
							margin-left: 12rpx;
							border-width: 10rpx;
							border-color: #999999 transparent transparent transparent;
							border-style: solid;
							vertical-align: bottom;
						}
					}
					.reply{
						overflow: hidden;
					}
					.replyUser{
						display: flex;
						.replyUserHead{
							width: 24rpx;
							height: 24rpx;
							margin-right: 10rpx;
							border-radius: 50%;
							overflow: hidden;
						}
						.replyUserName{
							color: #666;
							font-size: 20rpx;
							text{
								display: inline-block;
								font-size: 16rpx;
								width: 44rpx;
								height: 20rpx;
								line-height: 20rpx;
								text-align: center;
								background: #ff2d2d;
								border-radius: 4rpx;
								margin-left: 10rpx;
								color: #fff;
							}
							image{
								width: 16rpx;
								height: 16rpx;
								margin: 0 8rpx;
								vertical-align: middle;
							}
						}
					}
				}
				
			}
		}
		.nullComment{
			text-align: center;
			font-size: 24rpx;
			color: #333;
			margin-bottom: 170rpx;
		}
		.commentInput{
			position: fixed;
			bottom: 0;
			left: 0;
			width: 100%;
			border-top: 2rpx solid #E5E5E5;
			padding: 16rpx 30rpx;
			background-color: #fff;
			input{
				width: 100%;
				height: 52rpx;
				font-size: 28rpx;
				color: #000;
				padding: 0 20rpx;
				background-color: #E5E5E5;
				box-sizing: border-box;
				border-radius: 26px;
			}
		}
		.close{
			position: absolute;
			right: 30rpx;
			top: 20rpx;
			width: 28rpx;
			height: 28rpx;
		}
	}
</style>